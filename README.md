## Модуль интеграции с CMS Wordpress Woocommerce

Данный модуль обеспечивает взаимодействие между интернет-магазином на базе CMS WordPress с модулем электронной комерции WooCommerce и сервисом платежей [EPOS](https://e-pos.by)

### Требования ###
1. PHP 5.6 и выше 
1. Библиотека Curl 

## Инструкция по установке:
### Автоматическая установка (через Wordpress Plugin Directory) 
1. Перейти на страницу _Плагины > Добавить новый_
1. Введите в поиске _EPOS_
1. Установите плагин 
1. Активируйте плагин
1. Перейдите к настройке

### Ручная установка
1. Создайте резервную копию вашего магазина и базы данных
1. Загрузите архив модуля [wc-epos-gateway.zip](https://bitbucket.esas.by/projects/CG/repos/cmsgate-woocommerce-epos/browse/wc-epos-gateway.zip) с помощью _Модули_ -> _Установка расширений_
1. Через панель администратора Wordpress зайдите в меню __Плагины > Добавить новый__
1. Нажмите __Загрузить плагин__
1. Выберите загруженый в п2. архив модуля wc-epos-gateway.zip и установите
1. Активируйте плагин в меню Плагины -> Установленные
1. Перейдите к настройке

## Инструкция по настройке
1. Перейдите к настройке плагина через меню __WooCommerce -> Настройки -> Платежи__
1. Укажите обязательные параметры
    * EPOS процессинг - выбор организации, выполняющей интеграцию с EPOS
    * Идентификатор клиента – Ваш персональный логи для работы с сервисом EPOS
    * Секрет – Ваш секретный ключ для работы с сервисом EPOS
    * Код ПУ – код поставщика услуги в системе EPOS
    * Код услуги EPOS – код услуги у поставщика услуг в системе EPOS (один ПУ может предоставлять несколько разных услуг)
    * Код торговой точки – код торговой точки ПУ (у одного ПУ может быть несколько торговых точек)
    * Debug mode - запись и отображение дополнительных сообщений при работе модуля
    * Sandbox - перевод модуля в тестовый режим работы. В этом режиме счета выставляются в тестовую систему
    * Срок действия счета - как долго счет, будет доступен в ЕРИП для оплаты    
    * Статус при выставлении счета  - какой статус выставить заказу при успешном выставлении счета в ЕРИП (идентификатор существующего статуса из Магазин > Настройки > Статусы)
    * Статус при успешной оплате счета - какой статус выставить заказу при успешной оплате выставленного счета (идентификатор существующего статуса)
    * Статус при отмене оплаты счета - какой статус выставить заказу при отмене оплаты счета (идентификатор существующего статуса)
    * Статус при ошибке оплаты счета - какой статус выставить заказу при ошибке выставленния счета (идентификатор существующего статуса)
    * Секция "Инструкция" - если включена, то на итоговом экране клиенту будет доступна пошаговая инструкция по оплате счета в ЕРИП
    * Секция QR-code - если включена, то на итоговом экране клиенту будет доступна оплата счета по QR-коду
    * Секция Webpay - если включена, то на итоговом экране клиенту отобразится кнопка для оплаты счета картой (переход на Webpay)
    * Текст успешного выставления счета - текст, отображаемый кленту после успешного выставления счета. Может содержать html. В тексте допустимо ссылаться на переменные @order_id, @order_number, @order_total, @order_currency, @order_fullname, @order_phone, @order_address
    * Название способа оплаты - название, показываемое клиенту при оформлении заказа на этапе выбора способы оплаты заказа
    * Описание способа оплаты - название, показываемое клиенту при оформлении заказа на этапе выбора способы оплаты заказа
1. Сохраните изменения.

### Внимание!
Для автоматического обновления статуса заказа (после оплаты клиентом выставленного в ЕРИП счета) необходимо сообщить в службу технической поддержки сервиса EPOS адрес обработчика следующим образом (где будет указан ваш домен):
```
http://mydomen.my/wordpress/?wc-api=gateway_epos
```

_Разработано и протестировано с Wordpress v5.3.2 и WooCommerce v4.0.1_


### Файлы логов
Логи модуля доступны по пути:

`<wordpress home>/wp-content/plugins/woo-epos-gateway/vendor/esas/cmsgate-core/logs/cmsgate.log`


### История версий
* v1.1.1:
    * Исправление с включением/отключением модуля в настройках
* v1.10.0:
    * Исправление с автоматическим изменением статуса при оплате